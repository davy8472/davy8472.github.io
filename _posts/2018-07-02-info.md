---
layout:     post
title:      微信小程序篇(一) 研究汪大神的项目
subtitle:   记录学习到的知识点
date:       2018-07-02
author:     QangLee
header-img: img/weChat.jpg
catalog: true
tags:
    - gulp
    - node.js
    - pipe
---

从汪大神的小程序demo开始学习，对gulp感兴趣，我擦了，直接农耕升级到自动啊，现研究看看。

### 目录

- gulp 是啥
- gulp 怎么用
- 深挖怎么实现的
- 一些“皮毛”

## gulp 是啥

Gulp 是基于node.js的一个前端自动化构建工具，可以使用它构建自动化工作流程（前端集成开发环境）

## gulp 怎么用

    npm run generate

然后就开始填入文件名字就ok了，我填了“test”，直接在项目目录下就出现了一个文件夹“test”，然后文件夹下就自动出现了.js,.wxml,.wxss等界面所需文件，并且还自动在app.json的路由中直接配置了，简直不要太6



## 深挖怎么实现的

1.首先需要一个gulpfile.js文件,其中：

        gulp.task('generate', next => {
        inquirer.prompt([
        {
        type: 'input',
        name: 'pageName',
        message: 'Input the page name',
        default: 'index'
        },
        {
        type: 'confirm',
        name: 'needConfig',
        message: 'Do you need a configuration file',
        default: false
        },
        {
        type: 'list',
        name: 'styleType',
        message: 'Select a style framework',
        // choices: ['less', 'scss', 'css'],
        choices: ['less'],
        default: 'less'
        }
        ])
        .then(options => {
        console.log("选择完了就生成吧！");
        const res = generateFile(options)
        if (res) generateJson(options)
        })
        .catch(err => {
        throw new plugins.util.PluginError('generate', err)
        })
        })

2.研究“generatePage”函数的实现
过程：

1. Object.assign ：Object.assign是ES6新添加的接口，主要的用途是用来合并多个JavaScript的对象。

            options = Object.assign({
            name: 'index',
            json: false,
            less: false,
            scss: false,
            css: false
            }, options)   

收获：
1. 对一个对象没有赋值的属性赋值的时候，那么用这个方法就可以为这些属性赋一些默认值。
2. 扩展一个对象，并不修改这个对象，从而得到所需要的另一个对象            


## 一些“皮毛”

1.sourceMap:

gulp具有监视文件改动后并整合压缩编译的指定路径下的功能，对于为什么要压缩js代码呢，网上主流的说法：
JavaScript脚本正变得越来越复杂。大部分源码（尤其是各种函数库和框架）都要经过转换，才能投入生产环境。
常见的源码转换，主要是以下三种情况：

        (1) 压缩，减小体积。比如jQuery 1.9的源码，压缩前是252KB，压缩后是32KB。
        (2) 多个文件合并，减少HTTP请求数。
        (3) 其他语言编译成JavaScript。最常见的例子就是CoffeeScript。

2.gulp API：

初步了解了一下 gulp.src，gulp.task，gulp.dest
模糊的理解：gulp.src输出了一个文件并获得了Readable流，gulp.task创建了任务，gulp.dest将pipe进来的流写成文件然后输出到一个路径（参数）

3.pipe

pipe：管道，科普了一下具体的作用：
        管道是进程间通信的主要手段之一

通过pipe，了解到了Stream-流：

        Node.js，Stream 有四种流类型：
        Readable - 可读操作。
        Writable - 可写操作。
        Duplex - 可读可写操作.
        Transform - 操作被写入数据，然后读出结果。
        
举个项目中的栗子：

        gulp.task('compile:js', () => {
        return gulp.src(['src/**/*.js'])
        .pipe(plugins.sourcemaps.init())
        .pipe(plugins.babel())
        .pipe(plugins.if(isProduction, plugins.uglify(), plugins.sourcemaps.write('.')))
        .pipe(gulp.dest('dist'))

将一个流不断传向各个组件进行处理然后最后通过gulp.dest输出


